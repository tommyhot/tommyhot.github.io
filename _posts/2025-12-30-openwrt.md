---
layout: post
title: docker 部署OpenWrt软路由
tags: docker OpenWrt
stickie: true
---

OpenWrt 软路由可用于个性化的网络配置支持ssr,v2ray等多种协议，支持NAS、VPN、FRP 等多种工具集。


## 开启网卡混杂模式（以eth0为例）

首先需要查看网络环境 `ifconfig` ip跟电脑ip一致的那个网卡
```sh
ip link set eth0 promisc on
```
## 创建macvlan网络

subnet 和 gateway 跟局域网一致
```sh
docker network create -d macvlan \
  --subnet=192.168.1.0/24 \
  --gateway=192.168.1.1 \
  -o parent=eth0 \
  macnet
```

## 启动容器，设置ip为一个固定ip，与局域网不要重复
```sh
docker run --restart always --name OpenWrt -d \
  --network macnet \
  --ip 192.168.1.80 \
  --privileged \
  registry.cn-shanghai.aliyuncs.com/suling/openwrt:armv8 \
  /sbin/init
```

## 进入容器设置网络

需要设置ipaddr，gateway，dns
```sh
  docker exec -it OpenWrt /bin/sh
  vim /etc/config/network  
  /etc/init.d/network restart
  ```

## 登录OpenWrt

浏览器访问 192.168.1.80 密码为空


## 当容器出现问题时，可删除重建
```sh
docker network rm macnet
docker rm -f OpenWrt
```